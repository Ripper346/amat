\documentclass[10pt,twocolumn,letterpaper]{article}
\include{formatAndDefs}

\def\iccvPaperID{1142} % *** Enter the ICCV Paper ID here
\def\httilde{\mbox{\tt\raisebox{-.5ex}{\symbol{126}}}}

\begin{document}
\title{AMAT: Medial Axis Transform for Natural Images \\ Supplemental Material}
\maketitle
%\thispagestyle{empty}

\section{Introduction}\label{sec:introduction}
In this supplemental material we add details and qualitative results that we were not able to include in the main submission due to the limited space.
We analytically derive the computational complexity of the various steps of our method, and discuss ways of reducing it.
We also present additional qualitative results of medial axes computed with our method, and their respective reconstructions.
Finally, in the zip file for the supplemental material we include a video showing the execution of the greedy algorithm on a test image.
In the video we visualize the process of selecting disks and covering the image, as well as the medial axis construction and respective radii.

\section{Complexity Analysis}\label{sec:complexity}
First, we remind the reviewer of the notation for some useful quantities to make the supplemental material self-contained.
A disk of radius $r_j\in \scales = \{1,\ldots,R\}$, 
centered at point $\p{i}\in X^I \subset \R^2$, is denoted as $D_{\p{i},r_j} = D_{ij}$.
We also assume that $X^I$ is a universe of $N$ points in total, corresponding to the spatial support of an input RGB image $I$.

\paragraph{Encodings:} Computing the encodings $\f{ij}$ at all possible locations and scales involves convolving the input image 
with disk filters of radii $1,\ldots,R$. 
The complexity of this step is:
\begin{align}
\nonumber
O(N\cdot 1^2 + N\cdot 2^2 + \ldots + N \cdot R^2) = \\
O(N\sum_{r=1}^R r^2) = O(NR(R+1)(2R+1)/6) = O(NR^3).
\end{align}


\paragraph{Disk cost:} The most demanding step in our method is the computation of the disk costs
\begin{equation}
c_{ij} = \sum_k \sum_l \norm{\f{ij} - \f{kl} }^2 \quad \forall k,l: D_{kl} \subset D_{ij}.
\label{eq:diskcost}
\end{equation}
This quantity must be computed at all location-radius combinations, and \emph{for all the contained disks} of radii $r\in\scales$.
Let $r,r'\in\scales$ with $r<r'$ and consider a disk of radius $r'$, centered at point $\p{}'$, $D_{\p{}',r'}$.
A \emph{fully contained} disk $D_{\p{},r} \subset D_{\p{}',r'}$ can be placed anywhere inside the disk
$(x-x_{\p{}'})^2 + (y-y_{\p{}'})^2 < (r'-r)^2$.
It follows that the number of such contained disks for a given radius $r'$ is approximately
\begin{align}
N_d^{r'} & = \sum_{r=1}^{r'}  \pi (r'-r)^2  = \pi \sum_{r=1}^{r'} (r')^2 -2r'r + r^2 = k(r')^3,
\label{eq:ndr}
\end{align}
where $k$ is a constant factor.
Summing over all possible radii $r'\in\scales$ we have that the total number of disks at $\p{}$ is
\begin{equation}
N_d = \sum_{r'=1}^R N_d^{r'} = \sum_{r'=1}^R k (r')^3 = \frac{k(R(R+1))^2}{4} \sim R^4.
\label{eq:nd}
\end{equation}
This is the (approximate up to a constant factor) number of contained disks and respective encodings that are used to compute $c_{ij}$ at
all possible scales $r \in \scales$, at a single point in the image.
Repeating this process for all $N$ points in the image domain yields a total complexity of $O(NR^4)$.

%For simplicity, we make all derivations in the continuous domain, but they can be readily extended to the discrete domain.
%Let $r,r'\in(0,R]$, with $r<r'$, and consider a disk of radius $r'$, centered at point $\p{}'$, $D_{\p{}',r'}$.
%A \emph{fully contained} disk $D_{\p{},r} \subset D_{\p{}',r'}$ can be placed anywhere inside the disk
%$(x-x_{\p{}'})^2 + (y-y_{\p{}'})^2 \leq (r'-r)^2$.
%It follows that the number of such contained disks for a given radius $r'$ is
%\begin{equation}
%N_d^{r'} = \int_{0}^{r'}  \pi (r'-r)^2 dr,\label{eq:ndr}
%\end{equation}
%and summing over all possible radii $r'\in(0,R]$ we have that the total number of disks at $\p{}$ is
%\begin{equation}
%N_d = \int_0^R N_d^{r'}dr'.\label{eq:nd}
%\end{equation}
%Putting together~\refeq{eq:ndr} and~\refeq{eq:nd} we get:
%\begin{align}
%\nonumber
%N_d & = \pi \int_0^{R} \int_0^{r'} (r'-r)^2 dr dr' \\ \nonumber
%  & = \pi \int_0^{R} \int_0^{r'} (r')^2 -2r'r + r^2 dr dr' \\ \nonumber
%  & = \pi \int_0^{R} \left. (r')^2 r - r'r^2 + \frac{r^3}{3} \right \rvert_{0}^{r'} dr' \\ 
%  & = \pi \int_0^{R}  \frac{(r')^3}{3} dr' = \pi \left. \frac{(r')^4}{12}\right \rvert_0^R  = \frac{\pi}{12} R^4. 
%\end{align}
%This is the (approximate up to a constant factor) number of contained disks and respective encodings that are used to compute $c_{ij}$ at
%all possible scales $r \in (0,R]$, at a single point in the image.
%Repeating this process for all $N$ points in the image domain yields a total complexity of $O(NR^4)$.

\paragraph{Greedy approximation algorithm:} At each step of the greedy algorithm we cover at most $O(R^2)$ pixels in $X^I$,
but we also have to update costs for all partially and entirely covered disks, at all scales.
The greedy algorithm has complexity $O(N\sum_{r=1}^R r^2) = O(NR^3)$.


\subsection{Reducing Complexity}\label{sec:complexity:reducing}
The $O(NR^4)$ complexity derived in the previous section can be reduced through a combination of the following: 
i) rewriting~\refeq{eq:diskcost} in an equivalent form that is amenable to efficient computation using convolutions; 
ii) using cumulative sums to avoid redundant computations.
Since we will release our code, we do not elaborate further on i).

We provide an intuitive explanation for ii):
Suppose we use $\sum_{D_{ij}} \f{}$ to denote the sum of a quantity $\f{}$ within a disk area $D_{ij}$ of radius $r_j$.
Naively calculating this quantity for a disk of radius $r_l > r_j$ involves unnecessary re-computations of $\f{}$
in the area $D_{ij} \subset D_{il}$.
We can avoid these redundant computations, observing that 
\begin{equation}
\sum_{D_{ij}} \f{} = \sum_{j=1}^R \sum_{C_{ij}} \f{}, \label{eq:circlesum}
\end{equation}
where $C_{ij}$ is the \emph{circle} of radius $r_j$, centered at $\p{i}$.
Using the relationship in~\refeq{eq:circlesum} we reduce the complexity of computing feature encodings at all locations from
$O(NR^3)$ to $O(NR^2)$ and the complexity of disk cost computation from $O(NR^4)$ to $O(NR^3)$.

Using a shape other than disks in our approach allows us to reduce complexity even more.
For example, one can consider using rectangles or squares to approximate or replace disks, 
as in~\cite{arbelaez2011contour,tsogkas2012learning}.
In that scenario, pre-computing an integral image would allow us to use a fixed number of operations per image point, further
reducing the complexity of encoding and disk cost computation to $O(NR)$ and $O(NR^2)$, respectively.
Similarly, the complexity of the greedy algorithm can be reduced to $O(NR)$.
We aim to explore this in future work.



%We start by rewriting~\refeq{eq:diskcost} in the following form:
%\begin{align}
%\nonumber
%c_{ij} & = \sum_k \sum_l \norm{\f{ij} - \f{kl} }^2 = \sum_k \sum_l (\f{ij} - \f{kl} )^2 \\ \nonumber
%	   & = \f{ij}^2 \sum_k \sum_l 1  + \sum_k \sum_l \f{kl}^2 -2\f{ij}\sum_k \sum_l \f{kl} \\ 
%	   & = \f{ij}^2 N_d^{r_j}  + \sum_k \sum_l \f{kl}^2 -2\f{ij}\sum_k \sum_l \f{kl}  
%\end{align}
%The first term in equation



\begin{figure*}[t]
\centering
\def\imgw{0.245}

\def\img_id{85048}
\includegraphics[width=\imgw \textwidth]{\img_id_resized.jpg}
\includegraphics[width=\imgw \textwidth]{\img_id_axes_simplified.pdf}
\includegraphics[width=\imgw \textwidth]{\img_id_branches_simplified.pdf}
\includegraphics[width=\imgw \textwidth]{\img_id_gt_skel.pdf}

\def\img_id{295087}
\includegraphics[width=\imgw \textwidth]{\img_id_resized.jpg}
\includegraphics[width=\imgw \textwidth]{\img_id_axes_simplified.pdf}
\includegraphics[width=\imgw \textwidth]{\img_id_branches_simplified.pdf}
\includegraphics[width=\imgw \textwidth]{\img_id_gt_skel.pdf}

\def\img_id{145086}
\includegraphics[width=\imgw \textwidth]{\img_id_resized.jpg}
\includegraphics[width=\imgw \textwidth]{\img_id_axes_simplified.pdf}
\includegraphics[width=\imgw \textwidth]{\img_id_branches_simplified.pdf}
\includegraphics[width=\imgw \textwidth]{\img_id_gt_skel.pdf}

\def\img_id{101087}
\includegraphics[width=\imgw \textwidth]{\img_id_resized.jpg}
\includegraphics[width=\imgw \textwidth]{\img_id_axes_simplified.pdf}
\includegraphics[width=\imgw \textwidth]{\img_id_branches_simplified.pdf}
\includegraphics[width=\imgw \textwidth]{\img_id_gt_skel.pdf}

\def\img_id{54082}
\includegraphics[width=\imgw \textwidth]{\img_id_resized.jpg}
\includegraphics[width=\imgw \textwidth]{\img_id_axes_simplified.pdf}
\includegraphics[width=\imgw \textwidth]{\img_id_branches_simplified.pdf}
\includegraphics[width=\imgw \textwidth]{\img_id_gt_skel.pdf}
\caption{\textbf{Medial axes}. From left to right: Input image, AMAT medial axes, medial branches (color-coded), ground-truth skeletons.
Axis color indicates the respective encodings $\f{}$, and black is used for unused points.}
\label{fig:axes}
\end{figure*}



\begin{figure*}[t]
\centering
\def\imgw{0.195}

\def\img_id{3096}
\includegraphics[width=\imgw \textwidth]{\img_id_resized.jpg}
\includegraphics[width=\imgw \textwidth]{\img_id_rec_mil.png}
\includegraphics[width=\imgw \textwidth]{\img_id_rec_gtseg.png}
\includegraphics[width=\imgw \textwidth]{\img_id_rec_gtskel.png}
\includegraphics[width=\imgw \textwidth]{\img_id_rec_amat.png}

\def\img_id{300091}
\includegraphics[width=\imgw \textwidth]{\img_id_resized.jpg}
\includegraphics[width=\imgw \textwidth]{\img_id_rec_mil.png}
\includegraphics[width=\imgw \textwidth]{\img_id_rec_gtseg.png}
\includegraphics[width=\imgw \textwidth]{\img_id_rec_gtskel.png}
\includegraphics[width=\imgw \textwidth]{\img_id_rec_amat.png}

\def\img_id{119082}
\includegraphics[width=\imgw \textwidth]{\img_id_resized.jpg}
\includegraphics[width=\imgw \textwidth]{\img_id_rec_mil.png}
\includegraphics[width=\imgw \textwidth]{\img_id_rec_gtseg.png}
\includegraphics[width=\imgw \textwidth]{\img_id_rec_gtskel.png}
\includegraphics[width=\imgw \textwidth]{\img_id_rec_amat.png}

\def\img_id{295087}
\includegraphics[width=\imgw \textwidth]{\img_id_resized.jpg}
\includegraphics[width=\imgw \textwidth]{\img_id_rec_mil.png}
\includegraphics[width=\imgw \textwidth]{\img_id_rec_gtseg.png}
\includegraphics[width=\imgw \textwidth]{\img_id_rec_gtskel.png}
\includegraphics[width=\imgw \textwidth]{\img_id_rec_amat.png}

\def\img_id{54082}
\includegraphics[width=\imgw \textwidth]{\img_id_resized.jpg}
\includegraphics[width=\imgw \textwidth]{\img_id_rec_mil.png}
\includegraphics[width=\imgw \textwidth]{\img_id_rec_gtseg.png}
\includegraphics[width=\imgw \textwidth]{\img_id_rec_gtskel.png}
\includegraphics[width=\imgw \textwidth]{\img_id_rec_amat.png}

\def\img_id{101087}
\includegraphics[width=\imgw \textwidth]{\img_id_resized.jpg}
\includegraphics[width=\imgw \textwidth]{\img_id_rec_mil.png}
\includegraphics[width=\imgw \textwidth]{\img_id_rec_gtseg.png}
\includegraphics[width=\imgw \textwidth]{\img_id_rec_gtskel.png}
\includegraphics[width=\imgw \textwidth]{\img_id_rec_amat.png}

\caption{\textbf{Image reconstruction}. From left to right: Input image, MIL~\cite{tsogkas2012learning}, GT-seg, GT-skel, AMAT.}
\label{fig:experiments:reconstruction}
\end{figure*}





{\small
\bibliographystyle{ieee}
\bibliography{iccv2017.bib}
}

\end{document}